{
  "kind": "build_request",
  "title": "Switch Internet Identity origin to mcubes.net and implement missing email/password auth methods",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Implement Motoko backend support for email+password authentication so the frontend calls `(actor as any).signup`, `(actor as any).login`, `(actor as any).validateSession`, and `(actor as any).logout` do not throw “is not a function”.",
      "target": "backend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "Just email and pass signup and sinnin using popip",
          "Screenshot shows: \"actor.signup is not a function\""
        ]
      },
      "acceptanceCriteria": [
        "Backend canister exports `signup(email, password)`, `login(email, password)`, `validateSession(token)`, and `logout(token)` methods in `backend/main.mo`.",
        "Calling `signup` from the current `frontend/src/hooks/useEmailPasswordAuth.tsx` no longer throws a JavaScript runtime error and returns a Motoko Result type with `Ok`/`Err` fields as expected by the frontend.",
        "Calling `login` from the current `frontend/src/hooks/useEmailPasswordAuth.tsx` no longer throws a JavaScript runtime error and returns a Motoko Result type with `Ok`/`Err` fields as expected by the frontend.",
        "`validateSession` returns `Ok { userId; email }` for valid tokens and `Err` (or non-Ok) for invalid/expired tokens, matching the frontend restore-session logic.",
        "`logout` invalidates the provided session token so subsequent `validateSession` calls fail for that token."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Ensure the Internet Identity login flow uses `mcubes.net` as the origin shown to users (instead of `caffeine.xyz`) by updating the frontend configuration used by `useInternetIdentity` (derivation origin) and any related deployment/environment configuration.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "use mcubes.net as Domain and hope it can change in future",
          "Then let's use internet identity as default login and use own domain or canister means caffeine.xyz should not be visible"
        ]
      },
      "acceptanceCriteria": [
        "Internet Identity login popup displays `mcubes.net` (or the mcubes.net origin) when users authenticate.",
        "The app continues to function with Internet Identity after the domain change (actor creation in `frontend/src/hooks/useActor.ts` still succeeds after II login)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add support for changing the app domain in the future while preserving Internet Identity principals by configuring Internet Identity “alternative origins” and wiring the chosen derivation origin through the existing frontend config mechanism (used by `loadConfig()` / `config.ii_derivation_origin`).",
      "target": "both",
      "source": {
        "messageIds": [
          "recent-messages"
        ],
        "quotes": [
          "hope it can change in future"
        ]
      },
      "acceptanceCriteria": [
        "Frontend config supports setting `ii_derivation_origin` to a stable value that can remain constant across future domain changes.",
        "Project includes a clear, implemented configuration point for listing/using alternative origins so that moving from `mcubes.net` to a future domain does not change the user’s principal (when configured).",
        "No changes are made to `frontend/src/hooks/useInternetIdentity.ts` beyond consuming the config it already loads (i.e., keep the immutable hook file intact if it is on the immutable list in this environment)."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in `backend/main.mo` (single-actor architecture).",
    "Do not edit any files under `frontend/src/components/ui` (read-only UI components).",
    "Do not edit immutable frontend paths listed by the platform (e.g., `frontend/src/hooks/useInternetIdentity.ts`, `frontend/src/hooks/useActor.ts`, `frontend/src/main.tsx`)—compose around them via configuration or new files if needed."
  ],
  "nonGoals": [
    "Hiding or masking the domain name inside the Internet Identity popup (not supported by the Internet Identity protocol).",
    "Adding third-party authentication providers (Google/Facebook/GitHub/Auth0).",
    "Implementing real-time features (WebSockets/push notifications)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}